# Block direct push to main/master
sh .husky/scripts/no-direct-push-main-master.sh

# Check for conflicts with main before pushing
sh .husky/scripts/check-conflicts-with-main.sh

# Run TypeScript unit tests
npm test

# Run Kotlin linting check (no auto-format on push)
if command -v ktlint &> /dev/null; then
  echo "Running ktlint check on Kotlin files..."
  ktlint "android/src/**/*.kt" || exit 1
fi

# Run Kotlin unit tests
if [ ! -d "example/android" ] || [ ! -f "example/android/gradlew" ]; then
  echo "Android project not found. Run 'cd example && npx expo prebuild --platform android' first."
  exit 1
fi
echo "Running Kotlin unit tests..."
cd example/android && ./gradlew :amehmeto-tied-siren-blocking-overlay:testDebugUnitTest || exit 1
cd ../..
